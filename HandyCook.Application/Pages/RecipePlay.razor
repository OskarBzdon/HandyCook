@page "/recipe/{RecipeId:int}/{StepNo:int}"
@using HandyCook.Application.Data
@using HandyCook.Application.Services
@using global::AutoMapper

@inject ApplicationDbContext ctx
@inject NavigationManager NavigationManager
@inject IUserService UserService
@inject ISnackbar Snackbar
@inject IMapper Mapper
@inject ICognitiveSpeechService CognitiveService
@inject IJSRuntime JSRuntime
@inject CountdownTimerService CountdownTimerService

@if (Recipe is null || Step is null)
{
    <MudContainer>
        <MudCard>
            <MudSkeleton Animation="Animation.Wave" Height="200px" Width="100%" SkeletonType="SkeletonType.Rectangle" />
        </MudCard>
        <MudCard>
            <MudSkeleton Animation="Animation.Wave" Height="20px" Width="100px" />
            <MudGrid>
                <MudItem xs="12" sm="6">
                    <MudSkeleton Animation="Animation.Wave" Height="20px" Width="90%" />
                    <MudSkeleton Animation="Animation.Wave" Height="20px" Width="80%" />
                    <MudSkeleton Animation="Animation.Wave" Height="20px" Width="85%" />
                </MudItem>
                <MudItem xs="12" sm="6">
                    <MudSkeleton Animation="Animation.Wave" Height="20px" Width="90%" />
                    <MudSkeleton Animation="Animation.Wave" Height="20px" Width="80%" />
                    <MudSkeleton Animation="Animation.Wave" Height="20px" Width="85%" />
                </MudItem>
            </MudGrid>
        </MudCard>
        <MudCard>
            <MudSkeleton Animation="Animation.Wave" Height="20px" Width="100px" />
            <MudList>
                <MudListItem>
                    <MudSkeleton Animation="Animation.Wave" Height="10px" Width="90%" />
                </MudListItem>
                <MudListItem>
                    <MudSkeleton Animation="Animation.Wave" Height="10px" Width="90%" />
                </MudListItem>
                <MudListItem>
                    <MudSkeleton Animation="Animation.Wave" Height="10px" Width="90%" />
                </MudListItem>
            </MudList>
        </MudCard>
    </MudContainer>
}
else
{
    <MudSwipeArea OnSwipeEnd="OnSwipeDetected" Style="width: 100%;">
        <MudImage ObjectFit="ObjectFit.Cover" Height="160" Width="350" Src="@GetImageSrc(Step.MediaFile)" Alt="Step Image" Elevation="25" Class="rounded-lg" />
        <MudDivider DividerType="DividerType.Middle" />
        <MudText class="mt-4" Typo="Typo.h6">@Step.Description</MudText>
        @if (Step.Temperature is not default(double))
        {
            <MudText class="mt-6 mb-2" Typo="Typo.subtitle1">Temperature <MudIcon Icon="@Icons.Material.Filled.LocalFireDepartment" Title="Temperature" />@Step.Temperature &#8451;</MudText>
        }
    </MudSwipeArea>
    @if (timer is not null)
    {
        <MudTimePicker PickerVariant="PickerVariant.Static" Rounded="true" OpenTo="OpenTo.Minutes" @bind-Time="@CountdownTimerService.TimeLeft" />
    }
}
